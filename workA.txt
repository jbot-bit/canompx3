Pick B. Build bars_5m next.

But STOP: your check_drift.py is not actually written (it says “Wrote 1 lines” + header only). Same problem as earlier. If that file is incomplete, it’s a false sense of safety.

Step 1 — Fix check_drift.py first (fail-closed)

Open pipeline/check_drift.py

Confirm it contains real code + exits non-zero on violations.

If it’s only a docstring/header: have Claude rewrite it fully.

Minimum checks it must implement:

Scan these files: pipeline/ingest_dbn.py, pipeline/run_pipeline.py, pipeline/asset_configs.py

Fail if regex finds hardcoded SQL like WHERE symbol = 'MGC' or VALUES (... 'MGC' ...)

Scan ingest scripts: pipeline/ingest_dbn.py, pipeline/ingest_dbn_mgc.py

Fail if .apply( or .iterrows( appears (unless explicitly whitelisted with exact line+reason)

Scan ingest scripts for writes to other tables

Fail if INSERT INTO bars_5m / daily_features / validated_setups appears

Reply “done” when that file is confirmed real.

Step 2 — bars_5m builder spec (what to implement)

Create one new script: pipeline/build_bars_5m.py

Rules:

Input: bars_1m

Output: bars_5m only

Deterministic bucket:

bucket_ts = floor(epoch(ts_utc)/300)*300 (UTC)

For each (symbol, bucket_ts):

open = first open

high = max high

low = min low

close = last close

volume = sum volume

source_symbol: prefer the mode (most common) within the bucket; tie → lexicographic smallest

Idempotent for a date range:

DELETE existing rows in bars_5m for the UTC window

INSERT rebuilt rows

CLI:

--instrument (MGC now; later MNQ/NQ)

--start, --end

--dry-run

Step 3 — Update runner (remove stub for step 2 only)

run_pipeline.py:

Step 2 calls python pipeline/build_bars_5m.py ...

Step 3 (daily_features) stays NOT IMPLEMENTED fail-closed